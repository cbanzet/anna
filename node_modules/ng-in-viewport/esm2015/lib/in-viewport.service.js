/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable, NgZone } from '@angular/core';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
/**
 * @record
 */
export function InViewportRegistryEntry() { }
function InViewportRegistryEntry_tsickle_Closure_declarations() {
    /** @type {?} */
    InViewportRegistryEntry.prototype.root;
    /** @type {?} */
    InViewportRegistryEntry.prototype.targets;
    /** @type {?} */
    InViewportRegistryEntry.prototype.observer;
}
export class InViewportService {
    /**
     * @param {?} ngZone
     */
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.trigger$ = new Subject();
        this.registry = [];
    }
    /**
     * @param {?} entries
     * @return {?}
     */
    emitTrigger(entries) {
        if (Array.isArray(entries) && entries.length) {
            entries.forEach((entry) => this.trigger$.next(entry));
        }
    }
    /**
     * @param {?=} element
     * @return {?}
     */
    getRootElement(element) {
        return element && element.nodeType === Node.ELEMENT_NODE ? element : undefined;
    }
    /**
     * @param {?} root
     * @return {?}
     */
    findEntry(root) {
        return this.registry.find((entry) => entry.root === this.getRootElement(root));
    }
    /**
     * @param {?} target
     * @param {?} config
     * @return {?}
     */
    register(target, config) {
        this.ngZone.runOutsideAngular(() => {
            const /** @type {?} */ foundedEntry = this.findEntry(config.root);
            if (foundedEntry && !foundedEntry.targets.has(target)) {
                foundedEntry.targets.add(target);
                foundedEntry.observer.observe(target);
            }
            else {
                const /** @type {?} */ options = {
                    root: this.getRootElement(config.root),
                    rootMargin: config.rootMargin,
                    threshold: config.threshold
                };
                const /** @type {?} */ entry = {
                    root: this.getRootElement(config.root),
                    targets: new Set([target]),
                    observer: new IntersectionObserver((entries) => this.ngZone.run(() => this.emitTrigger(entries)), options)
                };
                entry.observer.observe(target);
                this.registry = [...this.registry, entry];
            }
        });
    }
    /**
     * @param {?} target
     * @param {?} config
     * @return {?}
     */
    unregister(target, config) {
        this.ngZone.runOutsideAngular(() => {
            const /** @type {?} */ foundedEntry = this.findEntry(config.root);
            if (foundedEntry) {
                const { observer, targets } = foundedEntry;
                if (targets.has(target)) {
                    observer.unobserve(target);
                    targets.delete(target);
                }
                if (targets.size === 0) {
                    observer.disconnect();
                    this.registry = this.registry.filter((entry) => entry !== foundedEntry);
                }
            }
        });
    }
}
InViewportService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] },
];
/** @nocollapse */
InViewportService.ctorParameters = () => [
    { type: NgZone, },
];
/** @nocollapse */ InViewportService.ngInjectableDef = i0.defineInjectable({ factory: function InViewportService_Factory() { return new InViewportService(i0.inject(i0.NgZone)); }, token: InViewportService, providedIn: "root" });
function InViewportService_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    InViewportService.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    InViewportService.ctorParameters;
    /** @type {?} */
    InViewportService.prototype.trigger$;
    /** @type {?} */
    InViewportService.prototype.registry;
    /** @type {?} */
    InViewportService.prototype.ngZone;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW4tdmlld3BvcnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWluLXZpZXdwb3J0LyIsInNvdXJjZXMiOlsibGliL2luLXZpZXdwb3J0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7Ozs7Ozs7Ozs7Ozs7O0FBZS9CLE1BQU07Ozs7SUFJSixZQUFvQixNQUFjO1FBQWQsV0FBTSxHQUFOLE1BQU0sQ0FBUTt3QkFIWSxJQUFJLE9BQU8sRUFBNkI7d0JBQy9DLEVBQUU7S0FFSDs7Ozs7SUFFOUIsV0FBVyxDQUFDLE9BQW9DO1FBQ3RELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDN0MsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUN2RDs7Ozs7O0lBR0ssY0FBYyxDQUFDLE9BQWlCO1FBQ3RDLE1BQU0sQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQzs7Ozs7O0lBR3pFLFNBQVMsQ0FBQyxJQUFhO1FBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7SUFHMUUsUUFBUSxDQUFDLE1BQWUsRUFBRSxNQUF3QjtRQUN2RCxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUNqQyx1QkFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsRUFBRSxDQUFDLENBQUMsWUFBWSxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0RCxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDakMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDdkM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTix1QkFBTSxPQUFPLEdBQVE7b0JBQ25CLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7b0JBQ3RDLFVBQVUsRUFBRSxNQUFNLENBQUMsVUFBVTtvQkFDN0IsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTO2lCQUM1QixDQUFDO2dCQUNGLHVCQUFNLEtBQUssR0FBNEI7b0JBQ3JDLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7b0JBQ3RDLE9BQU8sRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUMxQixRQUFRLEVBQUUsSUFBSSxvQkFBb0IsQ0FDaEMsQ0FBQyxPQUFvQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQzFGLE9BQU8sQ0FDUjtpQkFDRixDQUFDO2dCQUNGLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMvQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQzNDO1NBQ0YsQ0FBQyxDQUFDOzs7Ozs7O0lBR0UsVUFBVSxDQUFDLE1BQWUsRUFBRSxNQUF3QjtRQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUNqQyx1QkFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDakIsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsR0FBRyxZQUFZLENBQUM7Z0JBQzNDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUMzQixPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUN4QjtnQkFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZCLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztvQkFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxLQUFLLFlBQVksQ0FBQyxDQUFDO2lCQUN6RTthQUNGO1NBQ0YsQ0FBQyxDQUFDOzs7O1lBL0ROLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7OztZQWZvQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJblZpZXdwb3J0Q29uZmlnIH0gZnJvbSAnLi9pbi12aWV3cG9ydC1jb25maWcnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEluVmlld3BvcnRSZWdpc3RyeUVudHJ5IHtcbiAgcm9vdDogRWxlbWVudDtcbiAgdGFyZ2V0czogU2V0PEVsZW1lbnQ+O1xuICBvYnNlcnZlcjogSW50ZXJzZWN0aW9uT2JzZXJ2ZXI7XG59XG5cbmV4cG9ydCB0eXBlIEluVmlld3BvcnRUcmlnZ2VyID0gU3ViamVjdDxJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5PjtcbmV4cG9ydCB0eXBlIEluVmlld3BvcnRSZWdpc3RyeSA9IEluVmlld3BvcnRSZWdpc3RyeUVudHJ5W107XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEluVmlld3BvcnRTZXJ2aWNlIHtcbiAgcHVibGljIHJlYWRvbmx5IHRyaWdnZXIkOiBJblZpZXdwb3J0VHJpZ2dlciA9IG5ldyBTdWJqZWN0PEludGVyc2VjdGlvbk9ic2VydmVyRW50cnk+KCk7XG4gIHByaXZhdGUgcmVnaXN0cnk6IEluVmlld3BvcnRSZWdpc3RyeSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHt9XG5cbiAgcHJpdmF0ZSBlbWl0VHJpZ2dlcihlbnRyaWVzOiBJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5W10pIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShlbnRyaWVzKSAmJiBlbnRyaWVzLmxlbmd0aCkge1xuICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4gdGhpcy50cmlnZ2VyJC5uZXh0KGVudHJ5KSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRSb290RWxlbWVudChlbGVtZW50PzogRWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50ICYmIGVsZW1lbnQubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFID8gZWxlbWVudCA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgZmluZEVudHJ5KHJvb3Q6IEVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3RyeS5maW5kKChlbnRyeSkgPT4gZW50cnkucm9vdCA9PT0gdGhpcy5nZXRSb290RWxlbWVudChyb290KSk7XG4gIH1cblxuICBwdWJsaWMgcmVnaXN0ZXIodGFyZ2V0OiBFbGVtZW50LCBjb25maWc6IEluVmlld3BvcnRDb25maWcpOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICBjb25zdCBmb3VuZGVkRW50cnkgPSB0aGlzLmZpbmRFbnRyeShjb25maWcucm9vdCk7XG4gICAgICBpZiAoZm91bmRlZEVudHJ5ICYmICFmb3VuZGVkRW50cnkudGFyZ2V0cy5oYXModGFyZ2V0KSkge1xuICAgICAgICBmb3VuZGVkRW50cnkudGFyZ2V0cy5hZGQodGFyZ2V0KTtcbiAgICAgICAgZm91bmRlZEVudHJ5Lm9ic2VydmVyLm9ic2VydmUodGFyZ2V0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IGFueSA9IHtcbiAgICAgICAgICByb290OiB0aGlzLmdldFJvb3RFbGVtZW50KGNvbmZpZy5yb290KSxcbiAgICAgICAgICByb290TWFyZ2luOiBjb25maWcucm9vdE1hcmdpbixcbiAgICAgICAgICB0aHJlc2hvbGQ6IGNvbmZpZy50aHJlc2hvbGRcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZW50cnk6IEluVmlld3BvcnRSZWdpc3RyeUVudHJ5ID0ge1xuICAgICAgICAgIHJvb3Q6IHRoaXMuZ2V0Um9vdEVsZW1lbnQoY29uZmlnLnJvb3QpLFxuICAgICAgICAgIHRhcmdldHM6IG5ldyBTZXQoW3RhcmdldF0pLFxuICAgICAgICAgIG9ic2VydmVyOiBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG4gICAgICAgICAgICAoZW50cmllczogSW50ZXJzZWN0aW9uT2JzZXJ2ZXJFbnRyeVtdKSA9PiB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5lbWl0VHJpZ2dlcihlbnRyaWVzKSksXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKVxuICAgICAgICB9O1xuICAgICAgICBlbnRyeS5vYnNlcnZlci5vYnNlcnZlKHRhcmdldCk7XG4gICAgICAgIHRoaXMucmVnaXN0cnkgPSBbLi4udGhpcy5yZWdpc3RyeSwgZW50cnldO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHVucmVnaXN0ZXIodGFyZ2V0OiBFbGVtZW50LCBjb25maWc6IEluVmlld3BvcnRDb25maWcpOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICBjb25zdCBmb3VuZGVkRW50cnkgPSB0aGlzLmZpbmRFbnRyeShjb25maWcucm9vdCk7XG4gICAgICBpZiAoZm91bmRlZEVudHJ5KSB7XG4gICAgICAgIGNvbnN0IHsgb2JzZXJ2ZXIsIHRhcmdldHMgfSA9IGZvdW5kZWRFbnRyeTtcbiAgICAgICAgaWYgKHRhcmdldHMuaGFzKHRhcmdldCkpIHtcbiAgICAgICAgICBvYnNlcnZlci51bm9ic2VydmUodGFyZ2V0KTtcbiAgICAgICAgICB0YXJnZXRzLmRlbGV0ZSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0YXJnZXRzLnNpemUgPT09IDApIHtcbiAgICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgdGhpcy5yZWdpc3RyeSA9IHRoaXMucmVnaXN0cnkuZmlsdGVyKChlbnRyeSkgPT4gZW50cnkgIT09IGZvdW5kZWRFbnRyeSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19